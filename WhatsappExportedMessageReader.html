<!DOCTYPE html>  <html lang="az">  
<head>  
<meta charset="UTF-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<style>  
  :root {  
    --bg-light: #ece5dd;  
    --bg-dark: #121212;  
    --header-light: #075e54;  
    --header-dark: #1f2c34;  
    --mine-bg: #dcf8c6;  
    --mine-bg-dark: #054640;  
    --theirs-bg: #ffffff;  
    --theirs-bg-dark: #2a3942;  
    --text-light: #000;  
    --text-dark: #fff;  
    --time-color: rgba(0,0,0,0.45);  
    --time-color-dark: rgba(255,255,255,0.45);  
    --search-bg: #f0f0f0;  
    --search-bg-dark: #303030;  
    --border-radius: 20px;  
    --highlight: yellow;  
    --btn-bg: #075e54;  
    --btn-hover-bg: #0e7d66;  
  }  
  body {  
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
    background: var(--bg-light); color: var(--text-light);  
    display: flex; flex-direction: column; height: 100vh; overflow: hidden;  
    transition: background 0.5s, color 0.5s;  
  }  
  body.dark {  
    background: var(--bg-dark); color: var(--text-dark);  
  }  
  header {  
    background: var(--header-light); color: white;  
    padding: 12px 15px; display: flex; justify-content: space-between; align-items: center;  
    font-weight: 600; font-size: 18px; user-select: none;  
  }  
  body.dark header {  
    background: var(--header-dark);  
  }  
  #activeStatus {  
    font-size: 12px; opacity: 0.7;  
  }  
  #modeToggle {  
    background: none; border: none; color: white; font-size: 22px; cursor: pointer;  
    user-select: none; padding: 0; margin-left: 10px;  
    transition: transform 0.6s ease;  
  }  
  #modeToggle.sun {  
    transform: rotate(360deg);  
  }  
  /* Ayarlar dÃ¼ymÉ™si */  
  #settingsBtn {  
    background: none;  
    border: none;  
    font-size: 22px;  
    margin-left: 8px;  
    color: white;  
    cursor: pointer;  
    transition: color 0.3s ease;  
    user-select: none;  
  }  
  #settingsBtn:hover {  
    color: #4caf50;  
  }  .controls {
padding: 10px 15px;
background: var(--bg-light);
border-bottom: 1px solid #ccc;
display: flex;
gap: 10px;
align-items: center;
overflow: hidden;
flex-wrap: wrap;
}
body.dark .controls {
background: var(--bg-dark);
border-color: #444;
}

/* Gizli file input Ã¼Ã§Ã¼n label */
input[type="file"] {
display: none;
}
label.fileLabel {
flex: 1 1 150px;
max-width: 150px;
padding: 10px 15px;
background: var(--btn-bg);
color: white;
font-weight: 600;
font-size: 14px;
border-radius: var(--border-radius);
text-align: center;
cursor: pointer;
user-select: none;
transition: background 0.3s ease;
box-sizing: border-box;
}
label.fileLabel:hover {
background: var(--btn-hover-bg);
}
body.dark label.fileLabel {
background: var(--header-dark);
}
body.dark label.fileLabel:hover {
background: #265058;
}

input#search {
flex: 3 1 200px;
max-width: 100%;
padding: 8px 15px;
border-radius: var(--border-radius);
border: 1px solid #ccc;
background: var(--search-bg);
color: var(--text-light);
font-size: 14px;
box-sizing: border-box;
box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
}
input#search:focus {
outline: none;
box-shadow: 0 0 8px 2px #4CAF50;
}
body.dark input#search {
background: var(--search-bg-dark);
border-color: #555;
color: var(--text-dark);
}
.custom-dropdown {
  background-color: #075e54 !important; /* YaÅŸÄ±l fon */
  color: white !important;              /* AÄŸ yazÄ± */
  border: 2px solid #0e7d66 !important; /* TÃ¼nd yaÅŸÄ±l sÉ™rhÉ™d */
  padding: 10px 12px;
  border-radius: 6px;
  width: 240px;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  user-select: none;
  transition: none; /* HeÃ§ bir dÉ™yiÅŸmÉ™ animasiyasÄ± olmasÄ±n */
}

/* Hover zamanÄ± da rÉ™ng dÉ™yiÅŸmÉ™sin */
.custom-dropdown:hover {
  background-color: #0e7d66 !important;
}

/* AÃ§Ä±lan menyu */
.dropdown-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background-color: #0e7d66;
  border: 1px solid #1e7e34;
  border-top: none;
  z-index: 1000;
  max-height: 200px;
  overflow-y: auto;
  border-radius: 0 0 6px 6px;
}




/* Hover zamanÄ± da sabit yaÅŸÄ±l rÉ™ng */
.dropdown-options div:hover {
  background-color: #0e7d66;
}
.search-navigation {
padding: 8px 15px;
background: var(--bg-light);
border-bottom: 1px solid #ccc;
display: flex;
justify-content: flex-end;
gap: 10px;
}
body.dark .search-navigation {
background: var(--bg-dark);
border-color: #444;
}
button#prevBtn, button#nextBtn {
background: var(--btn-bg);
border: none;
color: white;
padding: 8px 16px;
border-radius: var(--border-radius);
font-weight: 600;
cursor: pointer;
transition: background 0.3s;
}
/* Ãœmumi font bÉ™dÉ™nÉ™ tÉ™tbiq olunur */
body {
  font-family: 'Arial', sans-serif !important;
}
/* ZIP dropdown tam aÃ§Ä±lan vÉ™ scroll ilÉ™ */
#zipDropdown {
  position: relative !important;
  overflow: visible !important;
  z-index: 1000;
}

#zipDropdown .dropdown-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  max-height: 250px; /* Scroll Ã¼Ã§Ã¼n limit */
  overflow-y: auto;
  background-color: #0e7d66;
  border: 1px solid #1e7e34;
  border-radius: 0 0 6px 6px;
  z-index: 1001;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
}

#zipDropdown.open .dropdown-options {
  display: block;
}

/* Scrollbar Chrome Ã¼Ã§Ã¼n */
#zipDropdown .dropdown-options::-webkit-scrollbar {
  width: 6px;
}

#zipDropdown .dropdown-options::-webkit-scrollbar-thumb {
  background-color: #ccc;
  border-radius: 4px;
}

/* BÃ¼tÃ¼n elementlÉ™rdÉ™ font mÉ™cburi tÉ™tbiq olunur */
select, input, button {
  font-family: inherit !important;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
  border: 1px solid #ccc;
  background: #075e54;
  color: white;
  cursor: pointer;
}

/* Fokus zamanÄ± vizual effekt */
select:focus, input:focus, button:focus {
  outline: none;
  border-color: #4caf50;
  box-shadow: 0 0 4px rgba(76, 175, 80, 0.5);
}
/* GÃ¼ndÃ¼z modunda bÃ¼tÃ¼n .custom-dropdown butonlarÄ± */
.custom-dropdown {
  background-color: #28a745; /* YaÅŸÄ±l fon */
  color: white;
  border: 1px solid #1e7e34;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}

/* GecÉ™ (dark mode) Ã¼Ã§Ã¼n .custom-dropdown */
body.dark .custom-dropdown {
  background: #2a3942 !important;
  border-color: #555 !important;
  color: #eee !important;
}

/* GecÉ™ modunda iÃ§indÉ™ki span yazÄ±sÄ± */
body.dark .custom-dropdown span {
  color: #eee !important;
}

/* AÃ§Ä±lan menyular Ã¼Ã§Ã¼n */
.custom-dropdown .dropdown-options {
  display: none;
  position: absolute;
  background-color: white;
  color: black;
  min-width: 160px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  z-index: 999;
  border-radius: 6px;
  margin-top: 4px;
  max-height: 200px;
  overflow-y: auto;
}

/* AÃ§Ä±lan menyularÄ±n div-lÉ™ri */
.custom-dropdown .dropdown-options div {
  padding: 8px 12px;
  cursor: pointer;
}

/* Hover effekti */
.custom-dropdown .dropdown-options div:hover {
  background-color: #ddd;
}

/* Dark modda aÃ§Ä±lan menyu vÉ™ yazÄ±lar */
body.dark .custom-dropdown .dropdown-options {
  background: #2a3942 !important;
  color: #eee !important;
}

body.dark .custom-dropdown .dropdown-options div {
  color: #eee !important;
}

body.dark .custom-dropdown .dropdown-options div:hover {
  background-color: #3a4a52 !important;
  color: #fff !important;
}
/* Dark mode Ã¼Ã§Ã¼n */
body.dark select,
body.dark input,
body.dark button {
  background: #2a3942;
  border-color: #555;
  color: #eee;
}
button#prevBtn:disabled, button#nextBtn:disabled {
background: #999;
cursor: default;
}
button#prevBtn:hover:not(:disabled), button#nextBtn:hover:not(:disabled) {
background: var(--btn-hover-bg);
}
body.dark button#prevBtn, body.dark button#nextBtn {
background: var(--header-dark);
}
body.dark button#prevBtn:hover:not(:disabled), body.dark button#nextBtn:hover:not(:disabled) {
background: #265058;
}
#messages {
flex: 1;
overflow-y: auto;
padding: 15px 12px 20px;
background: var(--bg-light);
display: flex;
flex-direction: column;
scroll-behavior: smooth;
-webkit-overflow-scrolling: touch;
}
body.dark #messages {
background: var(--bg-dark);
}
.message {
max-width: 75%;
padding: 10px 14px;
margin-bottom: 8px;
border-radius: var(--border-radius);
font-size: 14px;
word-wrap: break-word;
line-height: 1.3;
user-select: text;
}
.message.mine {
align-self: flex-start;
background: var(--theirs-bg);
color: var(--text-light);
border-bottom-left-radius: 0;
text-align: left;
direction: ltr;
}
body.dark .message.mine {
background: var(--theirs-bg-dark);
color: var(--text-dark);
}
.message.theirs {
align-self: flex-end;
background: var(--mine-bg);
color: var(--text-light);
border-bottom-right-radius: 0;
text-align: left;
direction: ltr;
}
body.dark .message.theirs {
background: var(--mine-bg-dark);
color: var(--text-dark);
}
.sender {
font-weight: 600;
font-size: 12px;
margin-bottom: 4px;
opacity: 0.75;
user-select: none;
text-align: left;
}
.time {
font-size: 10px;
color: var(--time-color);
opacity: 0.8;
margin-top: 4px;
text-align: right;
user-select: none;
}
body.dark .time {
color: var(--time-color-dark);
}
.message img, .message video {
max-width: 200px;
max-height: 200px;
margin-top: 8px;
border-radius: 14px;
display: block;
}
.message audio {
margin-top: 8px;
width: 180px;
outline: none;
display: block;
border-radius: 14px;
background: transparent;
}
.highlight {
background: var(--highlight);
color: black;
}
body.dark .highlight {
background: rgba(255, 255, 0, 0.4);
color: black;
}
@media (max-width: 480px) {
#messages {
padding: 12px 8px 16px;
}
.message {
max-width: 85%;
font-size: 15px;
}
.message img, .message video {
max-width: 160px;
max-height: 160px;
}
.message audio {
width: 140px;
}
}
/* YalnÄ±z #senderDropdown vÉ™ #zipDropdown aÃ§Ä±lan menyularÄ±ndakÄ± seÃ§imlÉ™rin fon vÉ™ yazÄ± rÉ™ngi */
#senderDropdown .dropdown-options div,
#zipDropdown .dropdown-options div {
  background-color: white !important; /* AÃ§Ä±lan menyu fonu aÄŸ */
  color: black !important;             /* YazÄ±lar qara */
}

/* Hover zamanÄ± fon vÉ™ rÉ™ng */
#senderDropdown .dropdown-options div:hover,
#zipDropdown .dropdown-options div:hover {
  background-color: #ddd !important;
  color: black !important;
}

/* Dark modda #senderDropdown vÉ™ #zipDropdown aÃ§Ä±lan menyu seÃ§imlÉ™rinin fon vÉ™ yazÄ± rÉ™ngi */
body.dark #senderDropdown .dropdown-options div,
body.dark #zipDropdown .dropdown-options div {
  background-color: #2a3942 !important; /* TÃ¼nd fon */
  color: #eee !important;               /* AÃ§Ä±q yazÄ± */
}

/* Dark modda hover zamanÄ± fon vÉ™ yazÄ± rÉ™ngi */
body.dark #senderDropdown .dropdown-options div:hover,
body.dark #zipDropdown .dropdown-options div:hover {
  background-color: #1e2a37 !important; /* Daha tÃ¼nd fon */
  color: #fff !important;                /* AÄŸ yazÄ± */
}
/* Dropdownun yerlÉ™ÅŸdiyi konteynerlÉ™rdÉ™ overflow visible olsun */
#senderDropdown, #zipDropdown {
  position: relative !important;
  z-index: 1000 !important;
  overflow: visible !important;
}

/* ÆgÉ™r varsa, dropdownun valideyn konteynerinÉ™ dÉ™ É™lavÉ™ et */
/* MÉ™sÉ™lÉ™n: */
.dropdown-parent-container {
  overflow: visible !important;
  position: relative !important;
  z-index: 1;
}
/* Ayarlar modal stili */
#settingsModal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 24px 32px;
  border-radius: 16px;
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
  z-index: 1000;
  max-width: 350px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  text-align: left;
  font-size: 15px;
  line-height: 1.6;
  color: #222;
  font-family: "Segoe UI", sans-serif;
}

body.dark #settingsModal {
  background: #1f2c34;
  color: #ddd;
}

#settingsOverlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

#settingsModal h3 {
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 22px;
  font-weight: bold;
  color: inherit;
}

#settingsModal select {
  margin-top: 10px;
  padding: 10px 12px;
  font-size: 14px;
  border-radius: 10px;
  border: 1px solid #bbb;
  width: 100%;
  box-sizing: border-box;
  background: #f9f9f9;
  color: #222;
}

body.dark #settingsModal select {
  background: #2a3942;
  border-color: #555;
  color: #eee;
}

#settingsModal button {
  margin-top: 28px;
  padding: 10px 24px;
  background: var(--btn-bg, #007bff);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
  transition: background 0.3s ease;
  width: 100%;
}


#settingsModal button:hover {
  background: var(--btn-hover-bg, #0056b3);
}
.custom-dropdown {
  position: relative;
  background: #f9f9f9;
  color: #222;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #bbb;
  cursor: pointer;
  user-select: none;
  width: 100%;
  box-sizing: border-box;
  font-size: 14px;
}
.custom-dropdown:focus {
  outline: none;
  box-shadow: 0 0 4px #4caf50;
}

.dropdown-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: #fff;
  color: #222;
  border: 1px solid #bbb;
  border-radius: 0 0 10px 10px;
  width: 100%;
  z-index: 999;
  max-height: 200px;
  overflow-y: auto;
}
#zipDropdown {
  position: relative !important;
  overflow: visible !important;
  z-index: 1000;
}

#zipDropdown.open .dropdown-options {
  display: block !important;
}

#zipDropdown .dropdown-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  max-height: 240px; /* Scroll Ã¼Ã§Ã¼n hÃ¼ndÃ¼rlÃ¼k */
  overflow-y: auto;
  background-color: #0e7d66;
  border: 1px solid #1e7e34;
  border-radius: 0 0 6px 6px;
  z-index: 1001;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
  scrollbar-width: thin;
  scrollbar-color: #ccc #0e7d66;
}

#zipDropdown .dropdown-options::-webkit-scrollbar {
  width: 6px;
}

#zipDropdown .dropdown-options::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}

.form-container,
.controls {
  overflow: visible !important;
  position: relative;
  z-index: 2;
}

.dropdown-options div {
  padding: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

.dropdown-options div:hover {
  background: #e0e0e0;
}

.custom-dropdown.open .dropdown-options {
  display: block;
}

/* Dark mode Ã¼Ã§Ã¼n */
body.dark .custom-dropdown {
  background: #2a3942;
  color: #eee;
  border-color: #555;
}

body.dark .dropdown-options {
  background: #1f2c34;
  color: #eee;
  border-color: #444;
}

body.dark .dropdown-options div:hover {
  background: #3b4a51
</style>

</head>  
<body>  <header>  
  <div>  
    WhatsApp Oxuyucu  
    <div id="activeStatus">Onlayn deyil</div>  
  </div>  
  <div>  
    <button id="modeToggle" onclick="toggleDarkMode()" aria-label="GecÉ™/gÃ¼ndÃ¼z rejimi">ğŸŒ™</button>  
    <button id="settingsBtn" title="Ayarlar" aria-label="Ayarlar" onclick="openSettings()">âš™ï¸</button>  
  </div>  
</header>  <div class="controls">  

<div class="form-container">
  <!-- Gizli fayl input -->  
  <input type="file" id="fileInput" accept=".zip" onchange="handleZipUpload(event)" />  

  <!-- Stil Ã¼Ã§Ã¼n label -->  
  <label for="fileInput" id="fileLabel" class="fileLabel" tabindex="0">ZIP fayl seÃ§...</label>  

<!-- Ä°STÄ°FADÆÃ‡Ä° Custom Dropdown -->
<select id="senderSelect" onchange="markAsMine()" style="display:none;">
  <option value="">Ä°stifadÉ™Ã§i seÃ§...</option>
</select>

<div class="custom-dropdown" id="senderDropdown" tabindex="0" onclick="toggleSenderDropdown()">
  <span id="selectedSenderText">Ä°stifadÉ™Ã§i seÃ§...</span>
  <div class="dropdown-options" id="senderDropdownOptions">
    <!-- JavaScript ilÉ™ doldurulacaq -->
  </div>
</div>

<!-- ZIP FAYLLARI Custom Dropdown -->
<select id="savedZipsDropdown" onchange="loadSavedZip(this.value)" style="display:none;">
  <option value="">ÆvvÉ™lki ZIP fayllarÄ±...</option>
</select>

<div class="custom-dropdown" id="zipDropdown" tabindex="0" onclick="toggleZipDropdown()">
  <span id="selectedZipText">ÆvvÉ™lki ZIP fayllarÄ±...</span>
  <div class="dropdown-options" id="zipDropdownOptions">
    <!-- JavaScript ilÉ™ doldurulacaq -->
  </div>
</div>
</div>

<style>
  .form-container {
    display: flex;        /* Yan-yana dÃ¼zÃ¼lÃ¼ÅŸ */
    align-items: center;  /* Åaquli ortalayÄ±r */
    gap: 10px;
    width: 100%;
  }

  #savedZipsDropdown {
    margin-left: auto;    /* É™n saÄŸda */
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    background: #075e54;
    color: white;
    min-width: 160px;
  }
</style> <input type="text" id="search" placeholder="Mesaj axtar..." oninput="onSearchInput()" autocomplete="off" aria-label="Mesaj axtar"/>  
</div>  <div class="search-navigation">  
  <button id="prevBtn" onclick="prevHighlight()" disabled aria-label="ÆvvÉ™lki axtarÄ±ÅŸ nÉ™ticÉ™si">ÆvvÉ™lki</button>  
  <button id="nextBtn" onclick="nextHighlight()" disabled aria-label="NÃ¶vbÉ™ti axtarÄ±ÅŸ nÉ™ticÉ™si">NÃ¶vbÉ™ti</button>  
</div>  <div id="messages"></div>  <!-- Ayarlar ModalÄ± -->  <div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">  
  <h3 id="settingsTitle">Ayarlar âš™ï¸</h3>  
  <p id="infoText"><strong>Info:</strong> Bu tÉ™tbiq ixrac olunmuÅŸ WhatsApp mesajlarÄ±nÄ± vÉ™ media fayllarÄ±nÄ± rahat oxumaq Ã¼Ã§Ã¼n nÉ™zÉ™rdÉ™ tutulub. Mesajlar vÉ™ media WhatsApp Ã¼slubunda gÃ¶stÉ™rilir, É™lavÉ™ funksiyalarla istifadÉ™si asandÄ±r.
</p>  
  <p id="authorText"><strong>HazÄ±rlayan:</strong> Nadir NÉ™cÉ™fzadÉ™</p>  
  <p id="contactText"><strong>ÆlaqÉ™ Gmail:</strong> nadirnecefzadenadirnecefzade@gmail.com</p>    <hr>  

<label for="langDropdown" id="langLabel"><strong>Dil seÃ§:</strong></label><br />
<div class="custom-dropdown" id="langDropdown" tabindex="0" onclick="toggleLangDropdown()">
  <span id="selectedLangText">AzÉ™rbaycan dili</span>
  <div class="dropdown-options" id="langDropdownOptions">
    <div onclick="selectLang('az')">AzÉ™rbaycan dili</div>
    <div onclick="selectLang('en')">English</div>
    <div onclick="selectLang('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>
    <div onclick="selectLang('tr')">TÃ¼rkÃ§e</div>
    <div onclick="selectLang('zh')">ä¸­æ–‡</div>
    <div onclick="selectLang('de')">Deutsch</div>
    <div onclick="selectLang('fr')">FranÃ§ais</div>
    <div onclick="selectLang('es')">EspaÃ±ol</div>
    <div onclick="selectLang('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
    <div onclick="selectLang('pt')">PortuguÃªs</div>
    <div onclick="selectLang('hi')">à¤¹à¤¿à¤¨à¥à¤¦à¥€</div>
    <div onclick="selectLang('ja')">æ—¥æœ¬èª</div>
  </div>
</div>
<label for="fontDropdown" id="fontLabel"><strong>YazÄ± stili:</strong></label>
<div class="custom-dropdown" id="fontDropdown" tabindex="0" onclick="toggleDropdown()">
  <span id="selectedFont">Segoe UI</span>
  <div class="dropdown-options" id="dropdownOptions">
    <div onclick="selectFont('Segoe UI')">Segoe UI</div>
    <div onclick="selectFont('Georgia')">Georgia</div>
    <div onclick="selectFont('Courier New')">Courier New</div>
    <div onclick="selectFont('Times New Roman')">Times New Roman</div>
  </div>
</div>

<label for="fontSizeDropdown" id="fontSizeLabel"><strong>YazÄ± Ã¶lÃ§Ã¼sÃ¼:</strong></label>
<div class="custom-dropdown" id="fontSizeDropdown" tabindex="0" onclick="toggleFontSizeDropdown()">
  <span id="selectedFontSizeText">Orta</span>
  <div class="dropdown-options" id="fontSizeDropdownOptions">
    <div onclick="selectFontSize('small')">KiÃ§ik</div>
    <div onclick="selectFontSize('medium')">Orta</div>
    <div onclick="selectFontSize('large')">BÃ¶yÃ¼k</div>
    <div onclick="selectFontSize('xlarge')">Ã‡ox bÃ¶yÃ¼k</div>
  </div>
</div>
</select>
  <button id="closeBtn" onclick="closeSettings()">BaÄŸla</button>
</div>  
<div id="settingsOverlay" onclick="closeSettings()"></div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>  <script>  
  let allMessages = [];  
  let displayedCount = 100; // ilk yÃ¼klÉ™nÉ™cÉ™k mesaj sayÄ±
  let highlights = [];  
  let currentHighlightIndex = -1;  
  
  function toggleDarkMode() {
  const btn = document.getElementById("modeToggle");
  const isDark = document.body.classList.contains("dark");
  
  if (isDark) {
    btn.classList.remove("sun");
    document.body.classList.remove("dark");
    btn.textContent = "ğŸŒ™";
    localStorage.setItem("wa_reader_theme", "light"); // yadda saxla
  } else {
    btn.classList.add("sun");
    document.body.classList.add("dark");
    btn.textContent = "â˜€ï¸";
    localStorage.setItem("wa_reader_theme", "dark"); // yadda saxla
  }
}

// SÉ™hifÉ™ yÃ¼klÉ™nÉ™ndÉ™ É™vvÉ™lki vÉ™ziyyÉ™ti tÉ™tbiq et
document.addEventListener("DOMContentLoaded", () => {
  const savedTheme = localStorage.getItem("wa_reader_theme");
  const btn = document.getElementById("modeToggle");
  
  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    btn.classList.add("sun");
    btn.textContent = "â˜€ï¸";
  } else {
    document.body.classList.remove("dark");
    btn.classList.remove("sun");
    btn.textContent = "ğŸŒ™";
  }
});
  
  function openSettings() {  
    document.getElementById("settingsModal").style.display = "block";  
    document.getElementById("settingsOverlay").style.display = "block";  
  }  
  function closeSettings() {  
    document.getElementById("settingsModal").style.display = "none";  
    document.getElementById("settingsOverlay").style.display = "none";  
  }  
  
  const text = {
  az: {
    settingsTitle: "Ayarlar âš™ï¸",
    infoText: "Bu tÉ™tbiq ixrac olunmuÅŸ WhatsApp mesajlarÄ±nÄ± vÉ™ media fayllarÄ±nÄ± rahat oxumaq Ã¼Ã§Ã¼n nÉ™zÉ™rdÉ™ tutulub. Mesajlar vÉ™ media WhatsApp Ã¼slubunda gÃ¶stÉ™rilir, É™lavÉ™ funksiyalarla istifadÉ™si asandÄ±r.",
    authorText: "HazÄ±rlayan: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "ÆlaqÉ™ Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Dil seÃ§:",
    closeBtn: "BaÄŸla",
    fileLabel: "ZIP fayl seÃ§...",
    searchPlaceholder: "Mesaj axtar...",
    prevBtn: "ÆvvÉ™lki",
    nextBtn: "NÃ¶vbÉ™ti",
    selectUserPlaceholder: "Ä°stifadÉ™Ã§i seÃ§...",
    selectZipPlaceholder: "ÆvvÉ™lki ZIP fayllarÄ±...",
    fontLabel: "YazÄ± stili:",
    fontSizeLabel: "YazÄ± Ã¶lÃ§Ã¼sÃ¼:",
    fontSizeOptions: {
      small: "KiÃ§ik",
      medium: "Orta",
      large: "BÃ¶yÃ¼k",
      xlarge: "Ã‡ox bÃ¶yÃ¼k"
    }
  },
  en: {
    settingsTitle: "Settings âš™ï¸",
    infoText: "This application is designed to make it easier to read exported WhatsApp messages and media files. Messages and media are shown in WhatsApp style, easy to use with additional features.",
    authorText: "Author: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Contact Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Select language:",
    closeBtn: "Close",
    fileLabel: "Select ZIP file...",
    selectZipPlaceholder: "Previous ZIP files...",
    searchPlaceholder: "Search messages...",
    prevBtn: "Previous",
    nextBtn: "Next",
    selectUserPlaceholder: "Select user...",
    fontLabel: "Font style:",
    fontSizeLabel: "Font size:",
    fontSizeOptions: {
      small: "Small",
      medium: "Medium",
      large: "Large",
      xlarge: "Extra large"
    }
  },
  ru: {
    settingsTitle: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ âš™ï¸",
    infoText: "Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ±Ğ»ĞµĞ³Ñ‡Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ WhatsApp Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ°Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ². Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ°Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑÑ Ğ² ÑÑ‚Ğ¸Ğ»Ğµ WhatsApp, ÑƒĞ´Ğ¾Ğ±Ğ½Ñ‹ Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼Ğ¸.",
    authorText: "ĞĞ²Ñ‚Ğ¾Ñ€: ĞĞ°Ğ´Ğ¸Ñ€ ĞĞ°Ğ´Ğ¶ĞµÑ„Ğ·Ğ°Ğ´Ğµ",
    contactText: "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº:",
    closeBtn: "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ",
    fileLabel: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ZIP Ñ„Ğ°Ğ¹Ğ»...",
    searchPlaceholder: "ĞŸĞ¾Ğ¸ÑĞº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹...",
    prevBtn: "ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹",
    nextBtn: "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹",
    selectUserPlaceholder: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ...",
    selectZipPlaceholder: "ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ ZIP-Ñ„Ğ°Ğ¹Ğ»Ñ‹...",
    fontLabel: "Ğ¡Ñ‚Ğ¸Ğ»ÑŒ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ°:",
    fontSizeLabel: "Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ°:",
    fontSizeOptions: {
      small: "ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹",
      medium: "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹",
      large: "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹",
      xlarge: "ĞÑ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹"
    }
  },
  tr: {
    settingsTitle: "Ayarlar âš™ï¸",
    infoText: "Bu uygulama, dÄ±ÅŸa aktarÄ±lan WhatsApp mesajlarÄ±nÄ± ve medya dosyalarÄ±nÄ± kolayca okumak iÃ§in tasarlanmÄ±ÅŸtÄ±r. Mesajlar ve medya WhatsApp stilinde gÃ¶sterilir, ek Ã¶zelliklerle kullanÄ±mÄ± kolaydÄ±r.",
    authorText: "HazÄ±rlayan: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Ä°letiÅŸim Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Dil seÃ§in:",
    closeBtn: "Kapat",
    fileLabel: "ZIP dosyasÄ± seÃ§...",
    searchPlaceholder: "Mesaj ara...",
    prevBtn: "Ã–nceki",
    nextBtn: "Sonraki",
    selectUserPlaceholder: "KullanÄ±cÄ± seÃ§...",
    selectZipPlaceholder: "Ã–nceki ZIP dosyalarÄ±...",
    fontLabel: "YazÄ± stili:",
    fontSizeLabel: "YazÄ± boyutu:",
    fontSizeOptions: {
      small: "KÃ¼Ã§Ã¼k",
      medium: "Orta",
      large: "BÃ¼yÃ¼k",
      xlarge: "Ã‡ok bÃ¼yÃ¼k"
    }
  },
  zh: {
    settingsTitle: "è®¾ç½® âš™ï¸",
    infoText: "è¯¥åº”ç”¨æ—¨åœ¨æ›´è½»æ¾åœ°é˜…è¯»å¯¼å‡ºçš„ WhatsApp æ¶ˆæ¯å’Œåª’ä½“æ–‡ä»¶ã€‚æ¶ˆæ¯å’Œåª’ä½“ä»¥ WhatsApp æ ·å¼æ˜¾ç¤ºï¼Œé™„åŠ åŠŸèƒ½ä½¿ç”¨æ–¹ä¾¿ã€‚",
    authorText: "ä½œè€…ï¼šNadir NÉ™cÉ™fzadÉ™",
    contactText: "è”ç³»é‚®ç®±ï¼šnadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "é€‰æ‹©è¯­è¨€ï¼š",
    closeBtn: "å…³é—­",
    fileLabel: "é€‰æ‹© ZIP æ–‡ä»¶...",
    searchPlaceholder: "æœç´¢æ¶ˆæ¯...",
    prevBtn: "ä¸Šä¸€ä¸ª",
    nextBtn: "ä¸‹ä¸€ä¸ª",
    selectUserPlaceholder: "é€‰æ‹©ç”¨æˆ·...",
    selectZipPlaceholder: "ä»¥å‰çš„ ZIP æ–‡ä»¶...",
    fontLabel: "å­—ä½“æ ·å¼ï¼š",
    fontSizeLabel: "å­—ä½“å¤§å°ï¼š",
    fontSizeOptions: {
      small: "å°",
      medium: "ä¸­",
      large: "å¤§",
      xlarge: "è¶…å¤§"
    }
  },
  de: {
    settingsTitle: "Einstellungen âš™ï¸",
    infoText: "Diese Anwendung wurde entwickelt, um exportierte WhatsApp-Nachrichten und Mediendateien leichter lesbar zu machen. Nachrichten und Medien werden im WhatsApp-Stil angezeigt, mit zusÃ¤tzlichen Funktionen leicht zu bedienen.",
    authorText: "Autor: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Kontakt Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Sprache wÃ¤hlen:",
    closeBtn: "SchlieÃŸen",
    fileLabel: "ZIP-Datei auswÃ¤hlen...",
    searchPlaceholder: "Nachrichten suchen...",
    prevBtn: "ZurÃ¼ck",
    nextBtn: "Weiter",
    selectUserPlaceholder: "Benutzer wÃ¤hlen...",
    selectZipPlaceholder: "FrÃ¼here ZIP-Dateien...",
    fontLabel: "Schriftstil:",
    fontSizeLabel: "SchriftgrÃ¶ÃŸe:",
    fontSizeOptions: {
      small: "Klein",
      medium: "Mittel",
      large: "GroÃŸ",
      xlarge: "Sehr groÃŸ"
    }
  },
  fr: {
    settingsTitle: "ParamÃ¨tres âš™ï¸",
    infoText: "Cette application est conÃ§ue pour faciliter la lecture des messages et fichiers multimÃ©dias WhatsApp exportÃ©s. Les messages et les mÃ©dias sont affichÃ©s dans le style WhatsApp, avec des fonctionnalitÃ©s supplÃ©mentaires faciles Ã  utiliser.",
    authorText: "Auteur : Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Gmail de contact : nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Choisir la langue :",
    closeBtn: "Fermer",
    fileLabel: "SÃ©lectionner le fichier ZIP...",
    searchPlaceholder: "Rechercher dans les messages...",
    prevBtn: "PrÃ©cÃ©dent",
    nextBtn: "Suivant",
    selectUserPlaceholder: "Choisir un utilisateur...",
    selectZipPlaceholder: "Fichiers ZIP prÃ©cÃ©dents...",
    fontLabel: "Style de police :",
    fontSizeLabel: "Taille de la police :",
    fontSizeOptions: {
      small: "Petit",
      medium: "Moyen",
      large: "Grand",
      xlarge: "TrÃ¨s grand"
    }
  },
  es: {
    settingsTitle: "ConfiguraciÃ³n âš™ï¸",
    infoText: "Esta aplicaciÃ³n estÃ¡ diseÃ±ada para facilitar la lectura de mensajes exportados de WhatsApp y archivos multimedia. Los mensajes y medios se muestran con el estilo de WhatsApp, fÃ¡cil de usar con funciones adicionales.",
    authorText: "Autor: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Contacto Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Seleccionar idioma:",
    closeBtn: "Cerrar",
    fileLabel: "Seleccionar archivo ZIP...",
    searchPlaceholder: "Buscar mensajes...",
    prevBtn: "Anterior",
    nextBtn: "Siguiente",
    selectUserPlaceholder: "Seleccionar usuario...",
    selectZipPlaceholder: "Archivos ZIP anteriores...",
    fontLabel: "Estilo de fuente:",
    fontSizeLabel: "TamaÃ±o de fuente:",
    fontSizeOptions: {
      small: "PequeÃ±o",
      medium: "Mediano",
      large: "Grande",
      xlarge: "Extra grande"
    }
  },
  ar: {
    settingsTitle: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸",
    infoText: "ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ØªØ³Ù‡ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ…Ù„ÙØ§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ÙØµØ¯Ù‘Ø±Ø© Ù…Ù† ÙˆØ§ØªØ³Ø§Ø¨. ØªÙØ¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¨Ø£Ø³Ù„ÙˆØ¨ ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø³Ù‡Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.",
    authorText: "Ø§Ù„Ù…Ø¤Ù„Ù: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªÙˆØ§ØµÙ„: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:",
    closeBtn: "Ø¥ØºÙ„Ø§Ù‚",
    fileLabel: "Ø§Ø®ØªØ± Ù…Ù„Ù ZIP...",
    searchPlaceholder: "Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...",
    prevBtn: "Ø§Ù„Ø³Ø§Ø¨Ù‚",
    nextBtn: "Ø§Ù„ØªØ§Ù„ÙŠ",
    selectUserPlaceholder: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...",
    selectZipPlaceholder: "Ù…Ù„ÙØ§Øª ZIP Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©...",
    fontLabel: "Ù†Ù…Ø· Ø§Ù„Ø®Ø·:",
    fontSizeLabel: "Ø­Ø¬Ù… Ø§Ù„Ø®Ø·:",
    fontSizeOptions: {
      small: "ØµØºÙŠØ±",
      medium: "Ù…ØªÙˆØ³Ø·",
      large: "ÙƒØ¨ÙŠØ±",
      xlarge: "ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹"
    }
  },
  pt: {
    settingsTitle: "ConfiguraÃ§Ãµes âš™ï¸",
    infoText: "Este aplicativo foi projetado para facilitar a leitura de mensagens exportadas do WhatsApp e arquivos de mÃ­dia. As mensagens e mÃ­dias sÃ£o exibidas no estilo WhatsApp, fÃ¡ceis de usar com recursos adicionais.",
    authorText: "Autor: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "Contato Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "Selecionar idioma:",
    closeBtn: "Fechar",
    fileLabel: "Selecionar arquivo ZIP...",
    searchPlaceholder: "Buscar mensagens...",
    prevBtn: "Anterior",
    nextBtn: "PrÃ³ximo",
    selectUserPlaceholder: "Selecionar usuÃ¡rio...",
    selectZipPlaceholder: "Arquivos ZIP anteriores...",
    fontLabel: "Estilo da fonte:",
    fontSizeLabel: "Tamanho da fonte:",
    fontSizeOptions: {
      small: "Pequeno",
      medium: "MÃ©dio",
      large: "Grande",
      xlarge: "Extra grande"
    }
  },
  hi: {
    settingsTitle: "à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸ âš™ï¸",
    infoText: "à¤¯à¤¹ à¤à¤ªà¥à¤²à¤¿à¤•à¥‡à¤¶à¤¨ à¤µà¥à¤¹à¤¾à¤Ÿà¥à¤¸à¤à¤ª à¤¸à¥‡ à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤ à¤•à¤¿à¤ à¤—à¤ à¤¸à¤‚à¤¦à¥‡à¤¶à¥‹à¤‚ à¤”à¤° à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤«à¤¼à¤¾à¤‡à¤²à¥‹à¤‚ à¤•à¥‹ à¤ªà¤¢à¤¼à¤¨à¤¾ à¤†à¤¸à¤¾à¤¨ à¤¬à¤¨à¤¾à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¡à¤¿à¤œà¤¼à¤¾à¤‡à¤¨ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤”à¤° à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤µà¥à¤¹à¤¾à¤Ÿà¥à¤¸à¤à¤ª à¤¶à¥ˆà¤²à¥€ à¤®à¥‡à¤‚ à¤¦à¤¿à¤–à¤¾à¤ à¤œà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚, à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤¸à¥à¤µà¤¿à¤§à¤¾à¤“à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤‰à¤ªà¤¯à¥‹à¤— à¤®à¥‡à¤‚ à¤†à¤¸à¤¾à¤¨à¥¤",
    authorText: "à¤²à¥‡à¤–à¤•: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "à¤¸à¤‚à¤ªà¤°à¥à¤• Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "à¤­à¤¾à¤·à¤¾ à¤šà¥à¤¨à¥‡à¤‚:",
    closeBtn: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
    fileLabel: "ZIP à¤«à¤¼à¤¾à¤‡à¤² à¤šà¥à¤¨à¥‡à¤‚...",
    searchPlaceholder: "à¤¸à¤‚à¤¦à¥‡à¤¶ à¤–à¥‹à¤œà¥‡à¤‚...",
    prevBtn: "à¤ªà¤¿à¤›à¤²à¤¾",
    nextBtn: "à¤…à¤—à¤²à¤¾",
    selectUserPlaceholder: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤šà¥à¤¨à¥‡à¤‚...",
    selectZipPlaceholder: "à¤ªà¤¿à¤›à¤²à¥€ ZIP à¤«à¤¼à¤¾à¤‡à¤²à¥‡à¤‚...",
    fontLabel: "à¤«à¤¼à¥‰à¤¨à¥à¤Ÿ à¤¶à¥ˆà¤²à¥€:",
    fontSizeLabel: "à¤«à¤¼à¥‰à¤¨à¥à¤Ÿ à¤†à¤•à¤¾à¤°:",
    fontSizeOptions: {
      small: "à¤›à¥‹à¤Ÿà¤¾",
      medium: "à¤®à¤§à¥à¤¯à¤®",
      large: "à¤¬à¤¡à¤¼à¤¾",
      xlarge: "à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤¬à¤¡à¤¼à¤¾"
    }
  },
  ja: {
    settingsTitle: "è¨­å®š âš™ï¸",
    infoText: "ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸWhatsAppãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã‚„ã™ãã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¡ãƒ‡ã‚£ã‚¢ã¯WhatsAppã‚¹ã‚¿ã‚¤ãƒ«ã§è¡¨ç¤ºã•ã‚Œã€è¿½åŠ æ©Ÿèƒ½ä»˜ãã§ä½¿ã„ã‚„ã™ã„ã§ã™ã€‚",
    authorText: "ä½œæˆè€…: Nadir NÉ™cÉ™fzadÉ™",
    contactText: "é€£çµ¡å…ˆ Gmail: nadirnecefzadenadirnecefzade@gmail.com",
    langLabel: "è¨€èªã‚’é¸æŠ:",
    closeBtn: "é–‰ã˜ã‚‹",
    fileLabel: "ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ...",
    searchPlaceholder: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œç´¢...",
    prevBtn: "å‰ã¸",
    nextBtn: "æ¬¡ã¸",
    selectUserPlaceholder: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ...",
    selectZipPlaceholder: "ä»¥å‰ã® ZIP ãƒ•ã‚¡ã‚¤ãƒ«...",
    fontLabel: "ãƒ•ã‚©ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«:",
    fontSizeLabel: "ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:",
    fontSizeOptions: {
      small: "å°",
      medium: "ä¸­",
      large: "å¤§",
      xlarge: "ç‰¹å¤§"
    }
  }
};
function changeLanguage() {
const lang = document.getElementById("langSelect").value;
const t = text[lang] || text.az;

document.getElementById("settingsTitle").textContent = t.settingsTitle;
document.getElementById("infoText").innerHTML = "<strong>Info:</strong> " + t.infoText;
document.getElementById("authorText").textContent = t.authorText;
document.getElementById("contactText").textContent = t.contactText;
document.getElementById("langLabel").textContent = t.langLabel;
document.getElementById("closeBtn").textContent = t.closeBtn;
document.getElementById("fileLabel").textContent = t.fileLabel;
document.getElementById("search").placeholder = t.searchPlaceholder;
document.getElementById("prevBtn").textContent = t.prevBtn;
document.getElementById("nextBtn").textContent = t.nextBtn;

// Burada É™lavÉ™ edirik:
const senderSelect = document.getElementById("senderSelect");
if (senderSelect && senderSelect.options.length > 0) {
senderSelect.options[0].text = t.selectUserPlaceholder;
}
}


// ZIP fayl yÃ¼klÉ™mÉ™ funksiyasÄ±  
  async function handleZipUpload(event) {  
    const file = event.target.files[0];  
    if (!file) return;  
  
    resetSearch();  
  
    try {  
      const zip = await JSZip.loadAsync(file);  
      let textContent = "";  
      const mediaFiles = {};  
  
      for (const [filename, zipEntry] of Object.entries(zip.files)) {  
        if (filename.endsWith(".txt") && !textContent) {  
          textContent = await zipEntry.async("string");  
        } else {  
          const blob = await zipEntry.async("blob");  
     mediaFiles[filename.split("/").pop()] = zipEntry; // blob yaradÄ±lmÄ±r
     
        } 
      } 
  // ZIP faylÄ± Base64 formatda yadda saxla
const reader = new FileReader();
reader.onload = () => {
  const savedZips = JSON.parse(localStorage.getItem("wa_reader_saved_zips") || "[]");
  const updated = savedZips.filter(z => z.name !== file.name);
  updated.push({ name: file.name, data: reader.result });
  localStorage.setItem("wa_reader_saved_zips", JSON.stringify(updated));
  populateSavedZipsDropdown();
};
reader.readAsDataURL(file);
      if (!textContent) {  
        alert("Mesaj faylÄ± (.txt) tapÄ±lmadÄ±.");  
        return;  
      }  
  
      allMessages = parseMessages(textContent, mediaFiles);  
      populateSenderDropdown(allMessages);
      detectMyName(allMessages);  
      displayedCount = 100;
displayMessages(allMessages, displayedCount);  
      updateActiveStatus();  
    } catch (e) {  
      alert("ZIP fayl oxunarkÉ™n xÉ™ta: " + e.message);  
    }  
  }  
  function populateSenderDropdown(messages) {
  const senderSet = new Set();
  messages.forEach(m => {
    if (m.sender) senderSet.add(m.sender.trim());
  });

  const select = document.getElementById("senderSelect");
  select.innerHTML = `<option value="">Ä°stifadÉ™Ã§i seÃ§...</option>`;

  Array.from(senderSet).sort().forEach(sender => {
    const option = document.createElement("option");
    option.value = sender;
    option.textContent = sender;
    select.appendChild(option);
  });
}
  
  function detectMyName(messages) {  
    const counts = {};  
    messages.forEach(m => {  
      if (m.sender) counts[m.sender] = (counts[m.sender] || 0) + 1;  
    });  
    let maxCount = 0, candidate = null;  
    for (const sender in counts) {  
      if (counts[sender] > maxCount) {  
        maxCount = counts[sender];  
        candidate = sender;  
      }  
    }  
    messages.forEach(m => {  
      m.isMine = (m.sender?.trim() === candidate?.trim());  
    });  
  }  
  
  function getMediaType(filename) {  
    const lower = filename.toLowerCase();  
    if (lower.endsWith(".webp") || lower.includes("sticker")) return "sticker";  
    if (lower.endsWith(".png") || lower.endsWith(".jpg") || lower.endsWith(".jpeg") || lower.endsWith(".gif")) return "image";  
    if (lower.endsWith(".mp4") || lower.endsWith(".webm") || lower.endsWith(".ogg")) return "video";  
    if (lower.endsWith(".mp3") || lower.endsWith(".wav") || lower.endsWith(".m4a") || lower.endsWith(".opus")) return "audio";  
    return null;  
  }  
  function markAsMine() {
  const selected = document.getElementById("senderSelect").value;
  allMessages.forEach(m => {
m.isMine = m.sender?.trim() !== selected;
  });
  displayedCount = 100;
displayMessages(allMessages, displayedCount);
  updateActiveStatus();
}
  
  function parseMessages(text, mediaFiles) {  
    const lines = text.split(/\r?\n/);  
    const msgs = [];  
  
    lines.forEach(line => {  
      let match;  
      if ((match = line.match(/^î€(.*?)î€ (.*?): (.*)$/))) {  
        msgs.push(buildMessage(match[1], match[2], match[3], mediaFiles));  
      } else if ((match = line.match(/^(.*?), (.*?) - (.*?): (.*)$/))) {  
        msgs.push(buildMessage(`${match[1]}, ${match[2]}`, match[3], match[4], mediaFiles));  
      } else if ((match = line.match(/^(.*?) (.*?) - (.*?): (.*)$/))) {  
        msgs.push(buildMessage(`${match[1]} ${match[2]}`, match[3], match[4], mediaFiles));  
      }  
    });  
  
    return msgs;  
  }  function changeFont() {
  const font = document.getElementById("fontSelect").value;
  const fontFamily = `'${font}', sans-serif`;
  
  // BÉ™dÉ™ni dÉ™yiÅŸirik
  document.body.style.setProperty("font-family", fontFamily, "important");
  
  // Mesaj konteynerindÉ™ki bÃ¼tÃ¼n elementlÉ™rÉ™ dÉ™ font tÉ™tbiq et
  const elems = document.querySelectorAll("#messages, #messages .message, #messages .sender, #messages .content, #settingsModal, select, input, button");
  elems.forEach(el => {
    el.style.setProperty("font-family", fontFamily, "important");
  });
  
  localStorage.setItem("wa_reader_font", font);
}
  
  function buildMessage(time, sender, content, mediaFiles) {  
    let media = null;  
    let mediaType = null;  
    for (const key in mediaFiles) {  
      if (content.includes(key)) {  
        media = mediaFiles[key];  
        mediaType = getMediaType(key);  
        break;  
      }  
    }  
    return { time, sender, content, media, mediaType, isMine: false };  
  }  
  
  function displayMessages(messages) {  
    const container = document.getElementById("messages");  
    container.innerHTML = "";  
  
    messages.forEach((msg, idx) => {  
      const div = document.createElement("div");  
      div.className = "message " + (msg.isMine ? "mine" : "theirs");  
      div.dataset.index = idx;  
  
      const mediaHTML = msg.media ? renderMedia(msg.media, msg.mediaType) : "";  
  
      div.innerHTML = `  
        <div class="sender">${escapeHtml(msg.sender)}</div>  
        <div class="content" id="content-${idx}">${escapeHtml(msg.content)}</div>  
        ${mediaHTML}  
        <div class="time">${escapeHtml(msg.time)}</div>  
      `;  
      container.appendChild(div);  
    });  
  
    container.scrollTop = container.scrollHeight;  
  }  
  
  function renderMedia(entryOrUrl, mediaType) {
  if (!entryOrUrl) return "";
  
  // ÆgÉ™r URL string-dirsÉ™
  if (typeof entryOrUrl === "string") {
    return renderMediaTag(entryOrUrl, mediaType);
  }
  
  // ÆgÉ™r hÉ™lÉ™ blob yaradÄ±lmayÄ±bsa (zipEntry-dir)
  const id = "media-" + Math.random().toString(36).substr(2, 9);
  
  setTimeout(async () => {
    try {
      const blob = await entryOrUrl.async("blob");
      const url = URL.createObjectURL(blob);
      const el = document.getElementById(id);
      if (el) el.src = url;
    } catch (e) {
      console.error("Media yÃ¼klÉ™nÉ™rkÉ™n xÉ™ta:", e);
    }
  }, 0);
  
  return renderMediaTag("", mediaType, id);
}
  
  function escapeHtml(text) {  
    if (!text) return "";  
    return text  
      .replace(/&/g, "&amp;")  
      .replace(/</g, "&lt;")  
      .replace(/>/g, "&gt;")  
      .replace(/"/g, "&quot;")  
      .replace(/'/g, "&#039;");  
  }  
  
  // AxtarÄ±ÅŸ funksiyalarÄ±  
  
  function onSearchInput() {  
    const query = document.getElementById("search").value.trim().toLowerCase();  
    resetHighlights();  
  
    if (!query) {  
      highlights = [];  
      currentHighlightIndex = -1;  
      updateHighlightButtons();  
      displayMessages(allMessages);  
      return;  
    }  
  
    highlights = [];  
  
    for(let idx = allMessages.length - 1; idx >= 0; idx--) {  
      const msg = allMessages[idx];  
      const textLow = msg.content.toLowerCase();  
      let startIndex = 0;  
      while(true) {  
        const foundIndex = textLow.indexOf(query, startIndex);  
        if (foundIndex === -1) break;  
        highlights.push({ msgIndex: idx, start: foundIndex, length: query.length });  
        startIndex = foundIndex + query.length;  
      }  
    }  
    
  
    if (highlights.length === 0) {  
      currentHighlightIndex = -1;  
      updateHighlightButtons();  
      displayMessages(allMessages);  
      return;  
    }  
  
    currentHighlightIndex = 0;  
    updateHighlightButtons();  
    showHighlight(currentHighlightIndex);  
  }  
  
  function resetHighlights() {  
    allMessages.forEach((msg, idx) => {  
      const contentDiv = document.getElementById(`content-${idx}`);  
      if(contentDiv) contentDiv.innerHTML = escapeHtml(msg.content);  
    });  
  }  
  
  function showHighlight(index) {  
    if (index < 0 || index >= highlights.length) return;  
    const highlight = highlights[index];  
    const msg = allMessages[highlight.msgIndex];  
  
    const contentDiv = document.getElementById(`content-${highlight.msgIndex}`);  
    if(!contentDiv) return;  
  
    const text = msg.content;  
    const before = escapeHtml(text.substring(0, highlight.start));  
    const highlightText = escapeHtml(text.substr(highlight.start, highlight.length));  
    const after = escapeHtml(text.substring(highlight.start + highlight.length));  
    contentDiv.innerHTML = `${before}<span class="highlight">${highlightText}</span>${after}`;  
  
    contentDiv.parentElement.scrollIntoView({ behavior: "smooth", block: "center" });  
  }  
  
  function updateHighlightButtons() {  
    document.getElementById("prevBtn").disabled = currentHighlightIndex <= 0;  
    document.getElementById("nextBtn").disabled = currentHighlightIndex < 0 || currentHighlightIndex >= highlights.length - 1;  
  }  
  
  function prevHighlight() {  
    if (currentHighlightIndex > 0) {  
      currentHighlightIndex--;  
      showHighlight(currentHighlightIndex);  
      updateHighlightButtons();  
    }  
  }  
  
  function nextHighlight() {  
    if (currentHighlightIndex < highlights.length - 1) {  
      currentHighlightIndex++;  
      showHighlight(currentHighlightIndex);  
      updateHighlightButtons();  
    }  
  }  
  
  function resetSearch() {  
    document.getElementById("search").value = "";  
    highlights = [];  
    currentHighlightIndex = -1;  
    updateHighlightButtons();  
  }  
  
  function updateActiveStatus() {  
    const statusEl = document.getElementById("activeStatus");  
    if (allMessages.length === 0) {  
      statusEl.textContent = "Onlayn deyil";  
    } else {  
      const lastMsg = allMessages[allMessages.length - 1];  
      statusEl.textContent = `Son mesaj: ${lastMsg.time} - ${lastMsg.sender}`;  
    }  
  }  
  
  // DildÉ™ dÉ™yiÅŸiklik zamanÄ± seÃ§imi yadda saxla vÉ™ dil yenilÉ™  
  document.addEventListener("DOMContentLoaded", () => {  
    const langSelect = document.getElementById("langSelect");  
    const savedLang = localStorage.getItem("wa_reader_lang") || "az";  
    langSelect.value = savedLang;  
    changeLanguage();  
  
    langSelect.addEventListener("change", () => {  
      localStorage.setItem("wa_reader_lang", langSelect.value);  
      changeLanguage();  
    }); 
    const translations = {
  aze: { selectUser: "Ä°stifadÉ™Ã§i seÃ§" },
  eng: { selectUser: "Select user" },
  rus: { selectUser: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ" },
  tr: { selectUser: "KullanÄ±cÄ± seÃ§" },
  zh: { selectUser: "é€‰æ‹©ç”¨æˆ·" },
  de: { selectUser: "Benutzer auswÃ¤hlen" },
  fr: { selectUser: "SÃ©lectionner un utilisateur" },
  
  es: { selectUser: "Seleccionar usuario" },
  ar: { selectUser: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" },
  pt: { selectUser: "Selecionar usuÃ¡rio" },
  hi: { selectUser: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤šà¥à¤¨à¥‡à¤‚" },
  ja: { selectUser: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ" }
};
  
    // Klaviaturada Enter dÃ¼ymÉ™si ilÉ™ fayl seÃ§mÉ™ label-dan inputa fokus vermÉ™k Ã¼Ã§Ã¼n  
    document.querySelector("label.fileLabel").addEventListener("keydown", e => {  
      if (e.key === "Enter" || e.key === " ") {  
        e.preventDefault();  
        document.getElementById("fileInput").click();  
      }  
    });  
  });
  function toggleDropdown() {
  document.getElementById("fontDropdown").classList.toggle("open");
}

function selectFont(font) {
  document.getElementById("selectedFont").textContent = font;

  const fontFamily = `'${font}', sans-serif`;
  document.body.style.setProperty("font-family", fontFamily, "important");

  const elems = document.querySelectorAll("#messages, #messages .message, #messages .sender, #messages .content, #settingsModal, input, button, .custom-dropdown");
  elems.forEach(el => {
    el.style.setProperty("font-family", fontFamily, "important");
  });

  localStorage.setItem("wa_reader_font", font);
  document.getElementById("fontDropdown").classList.remove("open");
}
// SÉ™hifÉ™ yÃ¼klÉ™nÉ™ndÉ™ É™vvÉ™lki seÃ§im tÉ™tbiq olunsun
document.addEventListener("DOMContentLoaded", () => {
  const savedFont = localStorage.getItem("wa_reader_font") || "Segoe UI";
  document.getElementById("selectedFont").textContent = savedFont;
  selectFont(savedFont);
});
function toggleLangDropdown() {
  document.getElementById("langDropdown").classList.toggle("open");
}

function selectLang(langCode) {
  const langTextMap = {
    az: "AzÉ™rbaycan dili",
    en: "English",
    ru: "Ğ ÑƒÑÑĞºĞ¸Ğ¹",
    tr: "TÃ¼rkÃ§e",
    zh: "ä¸­æ–‡",
    de: "Deutsch",
    fr: "FranÃ§ais",
    es: "EspaÃ±ol",
    ar: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
    pt: "PortuguÃªs",
    hi: "à¤¹à¤¿à¤¨à¥à¤¦à¥€",
    ja: "æ—¥æœ¬èª"
  };
  
  document.getElementById("selectedLangText").textContent = langTextMap[langCode];
  document.getElementById("langDropdown").classList.remove("open");
  
  localStorage.setItem("wa_reader_lang", langCode);
  changeLanguageFromCustom(langCode);
}

function changeLanguageFromCustom(langCode) {
  const t = text[langCode] || text.az;
  
  document.getElementById("settingsTitle").textContent = t.settingsTitle;
  document.getElementById("infoText").innerHTML = "<strong>Info:</strong> " + t.infoText;
  document.getElementById("authorText").textContent = t.authorText;
  document.getElementById("contactText").textContent = t.contactText;
  document.getElementById("langLabel").textContent = t.langLabel;
  document.getElementById("closeBtn").textContent = t.closeBtn;
  document.getElementById("fileLabel").textContent = t.fileLabel;
  document.getElementById("search").placeholder = t.searchPlaceholder;
  document.getElementById("prevBtn").textContent = t.prevBtn;
  document.getElementById("nextBtn").textContent = t.nextBtn;
  document.getElementById("fontLabel").innerHTML = "<strong>" + t.fontLabel + "</strong>";
  document.querySelector("label[for='fontSizeDropdown']").innerHTML = "<strong>" + t.fontSizeLabel + "</strong>";
  
  updateFontSizeDropdown(t);
  
  const senderSelect = document.getElementById("senderSelect");
  if (senderSelect && senderSelect.options.length > 0) {
    senderSelect.options[0].text = t.selectUserPlaceholder;
  }
  
  const zipSelect = document.getElementById("zipSelect");
  if (zipSelect && zipSelect.options.length > 0) {
    zipSelect.options[0].text = t.selectZipPlaceholder;
  }
  
  // â¬‡ï¸ BUNLARI ÆLAVÆ ET â¬‡ï¸
  document.getElementById("selectedSenderText").textContent = t.selectUserPlaceholder;
  document.getElementById("selectedZipText").textContent = t.selectZipPlaceholder;
}
function closeAllDropdowns(exceptId = "") {
  document.querySelectorAll(".custom-dropdown").forEach(drop => {
    if (drop.id !== exceptId) {
      drop.classList.remove("open");
    }
  });
}
function toggleLangDropdown() {
  closeAllDropdowns("langDropdown");
  document.getElementById("langDropdown").classList.toggle("open");
}
function toggleDropdown() {
  closeAllDropdowns("fontDropdown");
  document.getElementById("fontDropdown").classList.toggle("open");
}
function updateFontSizeDropdown(t) {
  const dropdown = document.getElementById("fontSizeDropdownOptions");
  const selected = document.getElementById("selectedFontSizeText");
  if (!dropdown || !selected) return;

  const savedKey = localStorage.getItem("wa_reader_font_size") || "medium";
  const options = t.fontSizeOptions;

  // SeÃ§ili baÅŸlÄ±ÄŸÄ± dÉ™yiÅŸ
  selected.textContent = options[savedKey];

  // KÃ¶hnÉ™lÉ™ri sil
  dropdown.innerHTML = "";

  // YenilÉ™rini É™lavÉ™ et
  for (const key in options) {
    const div = document.createElement("div");
    div.textContent = options[key];
    div.onclick = () => selectFontSize(key); // onclick funksiyasÄ±
    dropdown.appendChild(div);
  }
}

function toggleFontSizeDropdown() {
  closeAllDropdowns("fontSizeDropdown");
  document.getElementById("fontSizeDropdown").classList.toggle("open");
}
document.addEventListener("click", function (e) {
  const isDropdown = e.target.closest(".custom-dropdown");
  if (!isDropdown) {
    closeAllDropdowns();
  }
});
// SÉ™hifÉ™ yÃ¼klÉ™nÉ™ndÉ™ É™vvÉ™lki dil bÉ™rpa olunsun
document.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem("wa_reader_lang") || "az";
  selectLang(savedLang);
});
function selectFontSize(sizeKey) {
  const sizeMap = {
    small: { text: "KiÃ§ik", px: "13px" },
    medium: { text: "Orta", px: "15px" },
    large: { text: "BÃ¶yÃ¼k", px: "17px" },
    xlarge: { text: "Ã‡ox bÃ¶yÃ¼k", px: "19px" }
  };

  const selected = sizeMap[sizeKey] || sizeMap.medium;
  document.getElementById("selectedFontSizeText").textContent = selected.text;
  document.getElementById("fontSizeDropdown").classList.remove("open");

  // BÃ¼tÃ¼n yazÄ±lÄ± elementlÉ™rÉ™ font-size tÉ™tbiq et
  const textElements = document.querySelectorAll(
    "body, body *:not(script):not(style)"
  );
  textElements.forEach(el => {
    el.style.setProperty("font-size", selected.px, "important");
  });

  localStorage.setItem("wa_reader_font_size", sizeKey);
}
document.addEventListener("DOMContentLoaded", () => {
  const savedFont = localStorage.getItem("wa_reader_font") || "Segoe UI";
  selectFont(savedFont);

  const savedSizeKey = localStorage.getItem("wa_reader_font_size") || "medium";
  selectFontSize(savedSizeKey);
  
});
// Dropdown-u saxlanÄ±lmÄ±ÅŸ ZIP-lÉ™rlÉ™ doldur
function populateSavedZipsDropdown() {
  const select = document.getElementById("savedZipsDropdown");
  if (!select) return;

  const savedZips = JSON.parse(localStorage.getItem("wa_reader_saved_zips") || "[]");
  select.innerHTML = `<option value="">ÆvvÉ™lki ZIP fayllarÄ±...</option>`;
  
  savedZips.forEach(z => {
    const opt = document.createElement("option");
    opt.value = z.name;
    opt.textContent = z.name;
    select.appendChild(opt);
  });
}

// Dropdowndan seÃ§ilÉ™n ZIP-i oxu
function loadSavedZip(fileName) {
  if (!fileName) return;
  const savedZips = JSON.parse(localStorage.getItem("wa_reader_saved_zips") || "[]");
  const zipData = savedZips.find(z => z.name === fileName);
  if (!zipData) return;

  fetch(zipData.data)
    .then(res => res.blob())
    .then(blob => processZip(blob));
}

// SaxlanmÄ±ÅŸ ZIP-i oxu (ZIP-i emal edÉ™n funksiya)
async function processZip(fileOrBlob) {
  resetSearch();

  try {
    const zip = await JSZip.loadAsync(fileOrBlob);
    let textContent = "";
    const mediaFiles = {};

    for (const [filename, zipEntry] of Object.entries(zip.files)) {
      if (filename.endsWith(".txt") && !textContent) {
        textContent = await zipEntry.async("string");
      } else {
        const blob = await zipEntry.async("blob");
        mediaFiles[filename.split("/").pop()] = URL.createObjectURL(blob);
      }
    }

    if (!textContent) {
      alert("Mesaj faylÄ± (.txt) tapÄ±lmadÄ±.");
      return;
    }

    allMessages = parseMessages(textContent, mediaFiles);
    populateSenderDropdown(allMessages);
    detectMyName(allMessages);
    displayMessages(allMessages);
    updateActiveStatus();
  } catch (e) {
    alert("ZIP oxunarkÉ™n xÉ™ta: " + e.message);
  }
}
// Ä°STÄ°FADÆÃ‡Ä° Custom Dropdown
function toggleSenderDropdown() {
  closeAllDropdowns("senderDropdown");
  document.getElementById("senderDropdown").classList.toggle("open");
}

function selectSender(sender) {
  document.getElementById("selectedSenderText").textContent = sender;
  document.getElementById("senderDropdown").classList.remove("open");
  document.getElementById("senderSelect").value = sender;
  markAsMine();
}

function populateSenderDropdown(messages) {
  const senderSet = new Set();
  messages.forEach(m => {
    if (m.sender) senderSet.add(m.sender.trim());
  });

  const select = document.getElementById("senderSelect");
  const dropdown = document.getElementById("senderDropdownOptions");

  select.innerHTML = `<option value="">Ä°stifadÉ™Ã§i seÃ§...</option>`;
  dropdown.innerHTML = "";

  Array.from(senderSet).sort().forEach(sender => {
    const option = document.createElement("option");
    option.value = sender;
    option.textContent = sender;
    select.appendChild(option);

    const div = document.createElement("div");
    div.textContent = sender;
    div.onclick = () => selectSender(sender);
    dropdown.appendChild(div);
  });
}

// ZIP FAYLLARI Custom Dropdown
function toggleZipDropdown() {
  closeAllDropdowns("zipDropdown");
  document.getElementById("zipDropdown").classList.toggle("open");
}

function selectZip(name) {
  document.getElementById("selectedZipText").textContent = name;
  document.getElementById("zipDropdown").classList.remove("open");
  document.getElementById("savedZipsDropdown").value = name;
  loadSavedZip(name);
}

function populateSavedZipsDropdown() {
  const select = document.getElementById("savedZipsDropdown");
  const dropdown = document.getElementById("zipDropdownOptions");

  const savedZips = JSON.parse(localStorage.getItem("wa_reader_saved_zips") || "[]");
  select.innerHTML = `<option value="">ÆvvÉ™lki ZIP fayllarÄ±...</option>`;
  dropdown.innerHTML = "";

  savedZips.forEach(z => {
    const opt = document.createElement("option");
    opt.value = z.name;
    opt.textContent = z.name;
    select.appendChild(opt);

    const div = document.createElement("div");
    div.textContent = z.name;
    div.onclick = () => selectZip(z.name);
    dropdown.appendChild(div);
  });
}
document.getElementById("messages").addEventListener("scroll", () => {
  const container = document.getElementById("messages");

  // YuxarÄ±ya yaxÄ±nlaÅŸanda
  if (container.scrollTop < 100) {
    if (displayedCount < allMessages.length) {
      displayedCount += 50; // daha 50 mesaj É™lavÉ™ gÃ¶stÉ™r
      displayMessages(allMessages, displayedCount);
    }
  }
});
function renderMediaTag(src, type, id = null) {
  const common = id ? `id="${id}"` : `src="${src}"`;
  switch (type) {
    case "image":
    case "sticker":
      return `<img ${common} loading="lazy" alt="Media">`;
    case "video":
      return `<video ${common} controls preload="none" playsinline></video>`;
    case "audio":
      return `<audio ${common} controls preload="none"></audio>`;
    default:
      return "";
  }
}
</script></body>  
</html>